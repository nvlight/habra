<?php

namespace Tests\Feature\Api\Post;

use App\Models\Post;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class GetPostTest extends TestCase
{
    use RefreshDatabase;
    private Post $post;

    protected function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub

        $this->post = Post::factory()
            ->for(User::factory(), 'author')
            ->create();
    }

    /**
     * A basic feature test example.
     */
    public function test_get_post(): void
    {
        // sail artisan route:list --path=post
        // sail artisan migrate --database=testing
        // sail artisan test --filter=GetPostTest

        $response = $this->get(route('post.show', ['post' => $this->post->id]));

        $response->assertOk();

//        $response->dd();
//        $response->ddHeaders();
//        $response->ddSession();

        $response->assertJsonIsObject();

        $response->assertJsonStructure([
            'author',
            'author_id',
            'company_id',
            'title',
            'content',
            'difficulty',
            'views',
            'read_time',
            'likes',
            'status',
            'comments' => ['*' => []],
            'tags' => ['*' => []],
            'images' => ['*' => []],
        ]);

        $response->assertJson([
            'author_id' => $this->post->author_id,
            'company_id' => $this->post->company_id,
            'title' => $this->post->title,
            'content' => $this->post->content,
            'difficulty' => $this->post->difficulty,
            'views' => $this->post->views,
            'read_time' => $this->post->read_time,
            'likes' => $this->post->likes,
            'status' => $this->post->status,
        ]);
    }
}
